# -*- coding: utf-8 -*-
"""
Created on Thu Nov 26 17:29:37 2020

@author: Gurpinder
"""
from Bio import Entrez
import time


IUIS_allergens = {
'Profilin Aca f2': ['AIV43662.1'],
'Profilin Ama r2': ['ACP43298'],
'Profilin Amb a8': ['AAX77687'],
'Profilin Art v4': ['CAD12861'],
'Profilin Bet v2' : ['AAA16522'],
'Profilin Beta v2' : ['P85984'],
'Profilin Car m profilin': ['ABM53030.1'],
'Profilin Che a2': ['AAL92870'],
'Profilin Cor a2': ['AAK01235'],
'Profilin Cro s2': ['AAW81034'],
'Profilin Cyn d12': ['CAA69670'],
'Profilin Fra e profilin': ['AHL24660.1'],
'Profilin Hel a2': ['CAA75506'],
'Profilin Hev b8': ['CAA75312'],
'Profilin Hum s profilin': ['AAP15200.1'],
'Profilin Koc s2': ['AIV43661.1'],
'Profilin Mer a1': ['CAA73720'],
'Profilin Ole e2': ['CAA73035'],
'Profilin Ory s12': ['AAG32056'],
'Profilin Par j3': ['CAB44256'],
'Profilin Phl p12': ['CAA54686'],
'Profilin Pho d2': ['CAD10390'],
#'Profilin Pla I2': [''],
'Profilin Pro j2': ['AHY24177'],
'Profilin Sal k4': ['ACS34771'],
'Profilin Tri a12': ['CAA61943'],
'Profilin Zea m12': ['CAA51718'],
'Profilin Superfamily Amb a6': ['AAB51146'],
'Profilin Superfamily Art v3': ['P0C088'],
'Profilin Superfamily Bra o3': ['XP_013623213.1'], 
'Profilin Superfamily Can s3': ['CCK33472'],
#'Profilin Superfamily Cas s8': [], 
'Profilin Superfamily Gly m1': ['Q9S8F3'],
'Profilin Superfamily Hor v15': ['CAA45085'],
'Profilin Superfamily Par j1': ['CAA54587'],
'Profilin Superfamily Par j2': ['CAA65121'],
'Profilin Superfamily Pin p1': ['CTQ87571.1'],
'Profilin Superfamily Pla a3': ['CAL07989.1'], 
'Profilin Superfamily Pla or3': ['ABY21307'],
'Profilin Superfamily Sec c38': ['Q9S8H2'],
'Profilin Superfamily Tri a14': ['CAY54133'],
'Profilin Superfamily Tri a15': ['CBA13560'],
'Profilin Superfamily Tri a21': ['CAY54134'],
'Profilin Superfamily Tri a28': ['CAI84642'],
'Profilin Superfamily Tri a29': ['CAZ76052'],
'Profilin Superfamily Tri a30': ['CAA35597'],
'Profilin Superfamily Tri a40': ['CAA42453.1'],
'Profilin Superfamily Tri a44': ['AKJ77990.1'],
#'Expansin and expansin-like Agr a expansin': [''], 
#'Expansin and expansin-like Agr a group 1': [''],  
'Expansin and expansin-like Ant o1': ['Q7M1X6'],
#'Expansin and expansin-like Ant o expansin': ['Q7M1Y0'],
'Expansin and expansin-like Cyn d1': ['AAB50734'],
'Expansin and expansin-like Cyn d15': ['AAP80171'],
'Expansin and expansin-like Dac g1': ['Q7M1X8'],
'Expansin and expansin-like Dac g2': ['AAB23303'],
'Expansin and expansin-like Dac g3': ['AAB42200'],
#'Expansin and expansin-like Fes a expansin': [''], 
#'Expansin and expansin-like Fes a group 1': [''], 
'Expansin and expansin-like Hol I1': ['CAA81619'],
'Expansin and expansin-like Lol p1': ['AAA63279'],
'Expansin and expansin-like Lol p2': ['P14947'],
'Expansin and expansin-like Lol p3': ['P14948'],
'Expansin and expansin-like Ory s1': ['AAA86533'],
'Expansin and expansin-like Pas n1': ['ACA23876'],
'Expansin and expansin-like Pha a1': ['AAB35984'],
#'Expansin and expansin-like Phl p1': ['CAA81613'],
'Expansin and expansin-like Phl p2': ['CAA53529'],
'Expansin and expansin-like Poa p1': ['CAA10520'],
'Expansin and expansin-like Sor h1': ['AIL01316'],
'Expansin and expansin-like Sor h2': ['AIL01318'],
'Expansin and expansin-like Zea m1': ['AAA33496'],
'EF hand family Aln g4': ['CAA76831'],
'EF hand family Amb a10': ['AAX77686'],
'EF hand family Amb a9': ['AAX77684'],
'EF hand family Art v5': ['AAX85389'],
'EF hand family Bet v3': ['CAA55854'],
'EF hand family Bet v4': ['CAA60628'],
#'EF hand family Bra n polcalcin': ['S65145'], 
'EF hand family Bra r5': ['BAA09634'],
'EF hand family Che a3': ['AAL92871'],
#'EF hand family Cup a polcalcin': [''], 
'EF hand family Cyn d7': ['AAD00247'],
#'EF hand family Fra e polcalcin': [''], 
'EF hand family Jun o4': ['AAC15474'],
'EF hand family Ole e3': ['AAD05375'],
'EF hand family Ole e8': ['AAF31151'],
'EF hand family Ory s polcalcin': ['BAD13150.1'], 
'EF hand family Par j4': ['CAP05019'],
'EF hand family Phl p7': ['CAA76887'],
'EF hand family Syr v3': ['AAK01144'],
'Ole e 1 family Aca f1': ['AKV72166.1'],
'Ole e 1 family Ama r1': ['AKV72168'],
'Ole e 1 family Beta v1': ['P85983'],
'Ole e 1 family Che a1': ['AAL07319'],
'Ole e 1 family Cro s1': ['AAX93750'],
'Ole e 1 family Fra e1': ['AAQ08947'],
'Ole e 1 family Koc s1': ['AKV72169'],
'Ole e 1 family Lig v1': ['CAA54818'],
'Ole e 1 family Lol p11': ['Q7M1X5'],
'Ole e 1 family Ole e1': ['AAB32652'],
'Ole e 1 family Phl p11': ['AAN32987'],
'Ole e 1 family Pla l1': ['CAC41633'],
'Ole e 1 family Pro j1': ['AKV72167.1'],
'Ole e 1 family Sal k5': ['ADK22842'],
'Ole e 1 family Syr v1': ['S43242'],
#'Ole e 1 family Zea m Ole e 1-like': ['2209273A'],
'Polygalacturonase Cha o2': ['Q7M1E7'],
'Polygalacturonase Cry j2': ['BAA06172'],
'Polygalacturonase Jun a2': ['CAC05582'],
'Polygalacturonase Lil l polygalacturonase': ['AAZ91659.1'],
'Polygalacturonase Pas n polygalacturonidase': ['CBM42667.1'],
'Polygalacturonase Phl p13': ['CAB42886'],
'Polygalacturonase Pla a2': ['CAE52833'],
'Polygalacturonase Pla or2': ['ABY21306'],
'Polygalacturonase Sor h13': ['AIL01320'],
'Polygalacturonase Zea m polygalacturonase': ['ABD79096.1'],
'Bet v 1 family Aln g1': ['AAB24432'],
'Bet v 1 family Bet pl PR-10': ['CAA54696.1'],
'Bet v 1 family Bet v1': ['CAA33887'],
'Bet v 1 family Car b1': ['CAA47366'],
'Bet v 1 family Cas s1': ['ACJ23861'],
'Bet v 1 family Cor a1': ['CAA50327'],
'Bet v 1 family Fag s1': ['ACJ23864'],
'Bet v 1 family Ost c1': ['ADK39021'],
'Bet v 1 family Que a1': ['ABZ81045'],
'Group 5/6 grass pollen allergen Dac g group 5': ['AAK62278.1'],
'Group 5/6 grass pollen allergen Hol l5': ['CAB10765'],
'Group 5/6 grass pollen allergen Hor v5': ['AAB41585'],
'Group 5/6 grass pollen allergen Lol p5': ['AAA33405'],
'Group 5/6 grass pollen allergen Pha a5': ['P56164'],
'Group 5/6 grass pollen allergen Phl p5': ['CAA52753'],
'Group 5/6 grass pollen allergen Phl p6': ['CAA81608'],
'Group 5/6 grass pollen allergen Poa p5': ['AAG42254'],
'Group 5/6 grass pollen allergen Sec c5': ['CBG76811'],
'Pectate lyase Amb a1': ['AAA32665'],
'Pectate lyase Art v6': ['AAX85388'],
'Pectate lyase Cha o1': ['BAA08246'],
'Pectate lyase Cry j1': ['BAA05542'],
'Pectate lyase Cup a1': ['CAB62551'],
'Pectate lyase Cup s1': ['AAF72625'],
'Pectate lyase Jun a1': ['AAD03608'],
'Pectate lyase Jun o pectate lyase':['AAD03608.1'],
'Pectate lyase Jun v1': ['AAF80166'],
'Plant defensin Amb a4': ['CBK52317'],
'Plant defensin Art a defensin': ['AAO24900.1'], 
#'Plant defensin Art an defensin': [''],
#'Plant defensin Art c defensin': [''], 
#'Plant defensin Art f defensin': [''], 
#'Plant defensin Art l defensin': [''], 
#'Plant defensin Art t defensin': [''], 
'Plant defensin Art v1': ['AAO24900'],
'Plant defensin Par h1': ['AKF12278'],
'Thaumatin-like protein Cry j TLP': ['BAF51970.1'],
#'Thaumatin-like protein Cup a TLP': [''], 
'Thaumatin-like protein Cup s 3': ['AAR21073'],
'Thaumatin-like protein Jun a 3': ['AAF31759'],
#'Thaumatin-like protein Jun r TLP': [''], 
'Thaumatin-like protein Jun v 3': ['AAF80167'],
#'Thaumatin-like protein Ole e TLP':[''], 
'Berberine bridge enzyme Cyn d BG60': ['AAS02108.1'],
'Berberine bridge enzyme Dac g 4': ['P82946'],
'Berberine bridge enzyme Lol p 4': ['CAH92637'],
'Berberine bridge enzyme Phl p 4': ['CAD54670'],
'Berberine bridge enzyme Sec c BBE': ['CAH92630.1'],
'Isoflavone reductase family Bet v 6': ['AAC05116'],
'Isoflavone reductase family Cor a 6': ['AGU09563'],
'Isoflavone reductase family Cry j IFR': ['AAK27264.1'],
#'Isoflavone reductase family Ole e IFR': [''], 
'Beta-1,3-glucanase and X8 domain Ole e 10': ['AAL92578'],
'Beta-1,3-glucanase and X8 domain Ole e 4': ['P80741'],
'Beta-1,3-glucanase and X8 domain Ole e 9': ['AAK58515'],
'Cupin Coc n 1': ['	ALQ56981.1'],
'Cupin Cor a 11': ['AAL86739'],
'Cupin Cor a 9': ['AAL73404'],
'Group 5 ragweed allergen Amb a 5': ['P02878'],
'Group 5 ragweed allergen Amb p 5': ['AAA20065'],
'Group 5 ragweed allergen Amb t 5': ['CAA39726'],
'CAP family Art v 2': ['CAK50834'],
'CAP family Cyn d 24': ['AAU15051'],
'Cyclophilin Bet v 7': ['CAC84116'],
'Cyclophilin Cat r 1': ['CAA59468'],
'Glutathione S-transferase Bet v GST': ['AHF71027.1'],
'Glutathione S-transferase Tri a GST': ['ACE82289.1'],
'Papain-like cysteine protease Amb a 11': ['AHA56102'],
'Papain-like cysteine protease Ana c 2': ['BAA21849'],
'Pectin methylesterase Ole e 11': ['ACZ57582'],
'Pectin methylesterase Sal k 1': ['P83181'],
'Plant invertase/pectin methylesterase inhibitor Pla a 1': ['CAD20556'],
'Plant invertase/pectin methylesterase inhibitor Pla or 1': ['ABY21305'],
'1-Cys Peroxiredoxin Tri a 32': ['AAQ74769'],
#'Cellulase family A Cha o 3': ['GH5FP CHAOB'],
'Chitinase class III and peritrophin-like Cof a 1': ['ADH10372'],
'Colbalamin independent methionine synthase Sal k3': ['ACO34814'],
'Cu Zn Superoxide dismutase Ole e5': ['P80740'],
'Dehydrin Tri a35': ['CAY85463'],
'Eukaryotic aspartyl protease Cry j pepsin like': ['BAJ04354.1'],
'Gelsolin Nic t vilin': ['CAE17317.1'],
'GILT Tri a27': ['CAY85464'],
'Glyceraldehyde 3 phosphate dehydrogenase Tri a34': ['CAZ76054'],
'Hsp 70 Cor a10': ['CAC14168'],
'Hevein like and Class I II Chitinase Cry j Chitinase': ['BAD77932.1'],
'Metallothionein Cof a2': ['AGL34967'],
'Ole e 6 family Ole e6': ['AAB66909'],
'Plastocyanin Amb a3': ['P00304'],
'Potato inhibitor I family Tri a39': ['CCK33471'],
'Protein Kinase Sal k2': ['AAN05083'],
'SCAI Family Tri a43': ['AKJ77987.1'],
'Serpin serine protease inhibitor Tri a33': ['CAB52710'],
'Thioredoxin Zea m25': ['CAI64400'],
'Transcription elongation factor 1 Tri a45': ['AKJ77985.1'],
'Triosephosphate isomerase Tri a31': ['CAC14917'],
'Zinc finger C3HC4 type (RING finger) Tri a 41':['AKJ77988.1']
}

# Add Email here!!
Entrez.email = ''
if Entrez.email == '':
    print("Add your Email on line 230 - let NCBI know who you are!")
assert Entrez.email != ''

to_write = ''

for allergen in list(IUIS_allergens.keys()): # looping over the allergen keys
    print("Downloading for allergen {}".format(allergen))        
    for accession in IUIS_allergens[allergen]: #looping over the accession lists for each allergen.
        FASTA  = Entrez.efetch(db="protein", id=accession, rettype="fasta", retmode="text")
        to_write_temp = "\n".join(FASTA.read().split("\n")[1:])
        assert len(to_write_temp) > 0
        to_write = to_write + ">" + allergen + ", "+ accession +"\n"+ to_write_temp[:-1]

        
with open("allergens_IUIS_one.fasta", "w") as out_f:  
  out_f.write(to_write)

#with open("IUIS allergens.csv", "w") as out F:
#    to_write = ''
#    for allergen in list(IUIS allergens.keys()):
#        to_write = to write + allergen.split(" ")[0]+","+' '.join(allergen.split(" ")[1:] ) + "\n"
#    out F.write(to write)


    
    
    